#include "crc16.h"

unsigned short crc_table[256] = {
    0x0000, 0x1121, 0x2242, 0x3363, 0x4484, 0x55A5, 0x66C6, 0x77E7,
    0x9929, 0x8808, 0xBB6B, 0xAA4A, 0xDDAD, 0xCC8C, 0xFFEF, 0xEECE,
    0x3252, 0x2373, 0x1010, 0x0131, 0x76D6, 0x67F7, 0x5494, 0x45B5,
    0xAB7B, 0xBA5A, 0x8939, 0x9818, 0xEFFF, 0xFEDE, 0xCDBD, 0xDC9C,
    0x64A4, 0x7585, 0x46E6, 0x57C7, 0x2020, 0x3101, 0x0262, 0x1343,
    0xFD8D, 0xECAC, 0xDFCF, 0xCEEE, 0xB909, 0xA828, 0x9B4B, 0x8A6A,
    0x56F6, 0x47D7, 0x74B4, 0x6595, 0x1272, 0x0353, 0x3030, 0x2111,
    0xCFDF, 0xDEFE, 0xED9D, 0xFCBC, 0x8B5B, 0x9A7A, 0xA919, 0xB838,
    0xD969, 0xC848, 0xFB2B, 0xEA0A, 0x9DED, 0x8CCC, 0xBFAF, 0xAE8E,
    0x4040, 0x5161, 0x6202, 0x7323, 0x04C4, 0x15E5, 0x2686, 0x37A7,
    0xEB3B, 0xFA1A, 0xC979, 0xD858, 0xAFBF, 0xBE9E, 0x8DFD, 0x9CDC,
    0x7212, 0x6333, 0x5050, 0x4171, 0x3696, 0x27B7, 0x14D4, 0x05F5,
    0xBDCD, 0xACEC, 0x9F8F, 0x8EAE, 0xF949, 0xE868, 0xDB0B, 0xCA2A,
    0x24E4, 0x35C5, 0x06A6, 0x1787, 0x6060, 0x7141, 0x4222, 0x5303,
    0x8F9F, 0x9EBE, 0xADDD, 0xBCFC, 0xCB1B, 0xDA3A, 0xE959, 0xF878,
    0x16B6, 0x0797, 0x34F4, 0x25D5, 0x5232, 0x4313, 0x7070, 0x6151,
    0xB2D2, 0xA3F3, 0x9090, 0x81B1, 0xF656, 0xE777, 0xD414, 0xC535,
    0x2BFB, 0x3ADA, 0x09B9, 0x1898, 0x6F7F, 0x7E5E, 0x4D3D, 0x5C1C,
    0x8080, 0x91A1, 0xA2C2, 0xB3E3, 0xC404, 0xD525, 0xE646, 0xF767,
    0x19A9, 0x0888, 0x3BEB, 0x2ACA, 0x5D2D, 0x4C0C, 0x7F6F, 0x6E4E,
    0xD676, 0xC757, 0xF434, 0xE515, 0x92F2, 0x83D3, 0xB0B0, 0xA191,
    0x4F5F, 0x5E7E, 0x6D1D, 0x7C3C, 0x0BDB, 0x1AFA, 0x2999, 0x38B8,
    0xE424, 0xF505, 0xC666, 0xD747, 0xA0A0, 0xB181, 0x82E2, 0x93C3,
    0x7D0D, 0x6C2C, 0x5F4F, 0x4E6E, 0x3989, 0x28A8, 0x1BCB, 0x0AEA,
    0x6BBB, 0x7A9A, 0x49F9, 0x58D8, 0x2F3F, 0x3E1E, 0x0D7D, 0x1C5C,
    0xF292, 0xE3B3, 0xD0D0, 0xC1F1, 0xB616, 0xA737, 0x9454, 0x8575,
    0x59E9, 0x48C8, 0x7BAB, 0x6A8A, 0x1D6D, 0x0C4C, 0x3F2F, 0x2E0E,
    0xC0C0, 0xD1E1, 0xE282, 0xF3A3, 0x8444, 0x9565, 0xA606, 0xB727,
    0x0F1F, 0x1E3E, 0x2D5D, 0x3C7C, 0x4B9B, 0x5ABA, 0x69D9, 0x78F8,
    0x9636, 0x8717, 0xB474, 0xA555, 0xD2B2, 0xC393, 0xF0F0, 0xE1D1,
    0x3D4D, 0x2C6C, 0x1F0F, 0x0E2E, 0x79C9, 0x68E8, 0x5B8B, 0x4AAA,
    0xA464, 0xB545, 0x8626, 0x9707, 0xE0E0, 0xF1C1, 0xC2A2, 0xD383
};

void generateCrc(unsigned char* bytes, unsigned char* crc_code) {
    unsigned short crc = INITIAL_VALUE;
    for (unsigned char i = 0; i < BYTES_TO_CHECK; i++) {
        crc = (crc << 8) ^ crc_table[(crc >> 8) ^ bytes[i]];
    }
    crc_code[0] = crc >> 8;
    crc_code[1] = crc;
}